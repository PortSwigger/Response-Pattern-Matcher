/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */
apply plugin: 'java'
apply plugin: 'maven'
apply plugin: 'pmd'

group 'com.jackj07.rpm'

//Add version to jar name
version getVersion()

sourceCompatibility = 12.0
targetCompatibility = 12.0

//Keep updated
def getVersion(){
    return "v2.0"
}

//Build Jar
//Run tests first
task buildJar (type: Jar) {
    dependsOn 'test' //Run all tests before building
    //dependsOn 'pmdMain' //Run source code analysis before building
    //dependsOn 'pmdTest'

    baseName = project.name

    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } } {
        exclude '/test/*'
    }

    with jar
}

//Designate jar output directory
tasks.withType(Jar) {
    destinationDir = file("$rootDir/releases")
}

repositories {
    mavenCentral()
    maven {
        url "https://jitpack.io"
    }
}

dependencies {
    compile 'net.portswigger.burp.extender:burp-extender-api:1.7.22'
    compile 'com.github.CoreyD97:BurpExtenderUtilities:409993f66a0779ce469d4226fa6d4f4de12e1495'
    compile group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.10.0'
    testCompile files("/Applications/Burp Suite Community Edition.app/Contents/java/app/burpsuite_community.jar")
    testCompile group: 'org.mockito', name: 'mockito-core', version: '2.1.0'
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.3.1'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.3.1'
}

//Run JUnit tests using Gradle
test{
    useJUnitPlatform()
}

pmd {
    consoleOutput = true
    toolVersion = "6.21.0"
    rulePriority = 5
    ruleSets = ["category/java/errorprone.xml", "category/java/bestpractices.xml"]
}
